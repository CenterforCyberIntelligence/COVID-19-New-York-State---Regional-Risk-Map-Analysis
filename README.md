# New York State COVID-19 Analytics
### Regional Risk Mapping

This script was designed to assist in providing insight into each county's condition in New York as it pertains to the severity of the COVID-19 pandemic. Data analysis is divided by [Regional Councils](https://regionalcouncils.ny.gov/). Planners use the figures generated by this script to quickly visualize the regions in New York that are likely most at risk of local medical infrastructure becoming overwhelmed. This information is then used to make operational decisions.

Using publicly available information and insights gained from the New York State Department of Health, the script generates figures that reveal the current 14-day trend in COVID-19 cases (based on a seven-day rolling average) and provides insight into the potential for local medical infrastructure to be overwhelmed based on assessed ICU bed usage.

> The methodology supporting this script and its generated analysis is continuously evolving.

<br>

**ICU Capacity Calculations**

An important metric for determining if regions can "reopen" is whether hospitals can handle an increased load of new COVID-19 cases without having to resort to crisis standards of care. 

Although we would ideally be able to calculate actual real-time ICU load for every facility however we do not have access to all of this data. We are utilizing information provided by COVID Act Now to assist in understanding ICU usage.

> **What is ICU Headroom Usage?** For each county in New York, we know how many ICU Beds are available. Based on best available data, we estimate the number of beds currently occupied by non-COVID patients. Of the remaining ICU beds, we estimate the number that are needed by COVID cases, and represent this in a percentages. This number is used to assist in understanding whether there is likely enough capacity to absorb a wave of new COVID infections.

Not all New York State counties have ICU beds available, and not all counties with ICU beds report usage data. Where necessary, figures have been annotated. Where data is missing, we remove those records

Below is a basic description of how to read the figures.

* **Anything below the Yellow Line)** = 50% or less of available ICU headroom in use and less than 10 cases per 100k persons (7-day RA).
  * Any region falling into this area can likely handle a surge in cases of up to 50%.
* **Yellow Line** = between 50% and 60% ICU headroom in use and between 10 and 25 cases per 100k persons (7-day RA).
* **Orange Line** = between 60% and 70% ICU headroom in use and between 25 and 50 daily cases per 100k persons (7-day RA).
* **Red Line** = >70% ICU headroom in use and more than 50 daily cases per 100k persons (7-day RA).
  * Any region falling into this area is indicative of a significantly reduced surge capacity; these ICUs are likely highly utilized and could be overwhelmed quickly.

<br>

This project is based on data sourced from [COVID Act Now](https://www.covidactnow.org/).

We are utilizing data provided by the [COVID Act Now API](https://apidocs.covidactnow.org/).

---
This project is developed and maintained by [The Center for Cyber Intelligence](https://https://centerforcyberintelligence.org/)

**A very special thanks to [Philippe Langlois](https://www.linkedin.com/in/infosec-philippe-langlois/) for his exceptional contributions and assistance on this project. This project would not have been possible without his help.**

*This project is published under a [Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International license](https://creativecommons.org/licenses/by-nc-sa/4.0/), which requires users to attribute the source and license type (CC BY-NC-SA 4.0) when sharing, remixing, transforming, or building upon this material. Our preferred attribution is The Center for Cyber Intelligence.*

<hr>

### Script Requirements
This script was developed for Python 3.9.1 - Testing has been done with versions down to Python 3.8.5

I use pip to manage my python installations. To install pip for Python 3.x --> ```sudo apt install python3-pip```

The following Python libraries are required for this script to run.
* [pandas](https://pandas.pydata.org/)
  ```pip install pandas```
* [matplotlib](https://matplotlib.org/)
  ```pip install matplotlib```
* [python-pptx](https://python-pptx.readthedocs.io/en/latest/)
  ```pip install python-pptx```

To use Google Drive integration, you will need to follow the instructions below to enable the Google Drive API for your Google Account.

* Visit the [Google Drive Python Quickstart](https://developers.google.com/drive/api/v3/quickstart/python) guide and enable the Google Drive API for your Google account.
  * When enabling the Drive API:
    * Give your "project" a name (such as New York ICU Risk Analysis)
    * When prompted, configure your OAuth client as `Desktop app`
* Save your `credentials.json` file to the `../scripts/helper_files` folder.
* Run -> `pip install --upgrade google-api-python-client google-auth-httplib2 google-auth-oauthlib`
  * This step is not necessary if you have run `pip install -r requirements.txt` per the instructions in "Script Setup"
* Run -> `../scripts/helper_files/driveQuickstart.py`
    * This file has been modified to enable full, permissive scope to access all of a user's files, excluding the Application Data Folder
      * Using the ```quickstart.py``` file from the Google API Reference page will only allow you to "read" metadata of the user's drive files - i.e. it won't work for the purposes of this script.
    * You can find more information regarding drive Scope access [here](https://developers.google.com/drive/api/v3/about-auth).
* The sample will attempt to open a new window or tab in your default browser. If this fails, copy the URL from the console and manually open it in your browser.
  * Note if you are running this setup on a linux machine, you will need to go through this setup process first using a system that allows you to use a Web Browser and then manually move the generated `token.pickle` file to `../scripts/helper_files/` on your remote system.
* If you are not already logged into your Google account, you will be prompted to log in. If you are logged into multiple Google accounts, you will be asked to select one account to use for the authorization.
* Click the Accept button.
* The sample will proceed automatically, and you may close the window/tab.

You can always manage your Google API credentials and usage later in the [Google API Console](https://console.developers.google.com/apis/dashboard).

<hr>

### Script Setup
This script has been tested on Windows 10 Pro using Python 3.9.1 and Ubuntu 20.04 (LTS) using 2GB RAM and 60GB Disk Space

To set up this script for it's first run, follow the instructions below:

1. Verify you are running a compatible version of Python and you have `pip` installed.
2. Clone this GitHub repo to a working directory of your choice.
    * `git clone https://github.com/CenterforCyberIntelligence/COVID-19_New-York-State-Regional-Risk-Map-Analysis.git`
3. Run `pip install -r requirements.txt` - This will install all necessary Python libraries for this script to run.
4. Within the newly cloned Git repo, navigate to the `../modules` directory.
5. Run `python3 driveSetup.py`
    * Before running this script, ensure you have met all requirements needed to run Google Drive integration via the Drive API using the instructions above.
6. **KNOWN ISSUE**: For now you will need to create a folder for the PowerPoint function. I should have this fixed in a coming minor version update.
    * Create a folder called `Daily Slides` under the parent `COVID-19_New-York-State-Regional-Risk-Map-Analysis` directory
7. You should be good to go now! --> Run `../scripts/main.py`

<hr>

#### CRON Job Setup
For this project, I personally am running the script on a Ubuntu 20.04 (LTS) Digital Ocean Droplet.
To set up this script to run daily, feel free to set up a CRON Job using the following guide.

First, you will need to set up a simple `bash` file to execute `main.py`
1. In your `/home` directory, set up a bash file called `analysis.sh`:
```
#! /usr/bin/bash

cd /home/Data_Analytics_Projects/COVID-19_New-York-State-Regional-Risk-Map-Analysis/scripts
python3 main.py

```
2. Run `chmod +x /home/analysis.sh` to enable the file to run as an executable.
3. Run `crontab -e`
4. At the end of the file, add the following line: `0 7 * * * * $(which bash) /home/analysis.sh >> /var/log/cron.log 2>&1`
    * This line will tell the system to run the `analysis.sh` file every day at 7am using bash and log all output to a log file called `cron.log` under the standard system logs directory.
    * **Important:** The CRON job will run based on the current system time. You should ensure your system time zone is set up to reflect your current time zone before designating a time to run your CRON job. Most system defaults are UTC.
    * A helpful resource to ensure your CRON job time syntax is correct can be found [here](https://crontab.guru/#0_7_*_*_*).